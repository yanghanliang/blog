webpackJsonp([27],{OPrR:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("mvHQ"),s=r.n(a),n=r("Xxa5"),i=r.n(n),o=r("exGp"),l=r.n(o),c={name:"handleArticle",data:function(){var t,e=this;return{form:{title:"",classname:"",synopsis:"",content:"",categoryId:"",id:"",original:0,userId:[0]},initFormData:{title:""},buttonText:"添加文章",url:"addArticle",type:"post",categoryData:"",userList:[],rules:{title:[{required:!0,validator:(t=l()(i.a.mark(function t(r,a,s){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isEdit||a!==e.initFormData.title){t.next=2;break}return t.abrupt("return",s());case 2:if(a){t.next=4;break}return t.abrupt("return",s(new Error("请输入标题")));case 4:return t.next=6,e.$http.get("article/isExistence?title="+a);case 6:if(!t.sent){t.next=9;break}return t.abrupt("return",s(new Error("此标题已存在，请重新输入标题")));case 9:s();case 10:case"end":return t.stop()}},t,e)})),function(e,r,a){return t.apply(this,arguments)}),trigger:"change"}],classname:[{required:!0,message:"请选择分类",trigger:"change"}],synopsis:[{required:!0,message:"请输入内容",trigger:"change"}]}}},computed:{isEdit:function(){return this.$route.path.includes("/admin/editArticle")}},created:function(){this.getCategoryData(),this.getUserList();var t=this.$route.params.articleId;if(this.isEdit){var e=window.sessionStorage.getItem("articleData");if(e)return this.form=JSON.parse(e),this.type="put",this.buttonText="修改文章",void(this.url="editArticle/"+t)}t&&this.getEditData(t)},methods:{addArticle:function(){var t=this;return l()(i.a.mark(function e(){var r,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.Global.verification(t,"form");case 2:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return t.form.classname="string"==typeof t.form.classname?t.form.categoryId:t.form.classname,window.sessionStorage.setItem("articleData",s()(t.form)),e.next=9,t.$http[t.type](t.url,t.form);case 9:r=e.sent,200===(a=r.data).status?(t.$message({type:"success",message:a.msg,center:!0}),t.$router.push({name:"articleList"}),window.sessionStorage.removeItem("articleData")):a&&t.$message({type:"error",message:a.msg,center:!0});case 12:case"end":return e.stop()}},e,t)}))()},getEditData:function(t){var e=this;return l()(i.a.mark(function r(){var a,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$http.get("articleDetails/"+t);case 2:a=r.sent,s=[],a.user_id&&(s=(s=a.user_id.split(",")).map(function(t){return Number(t)})),e.form.title=a.title,e.initFormData.title=a.title,e.form.classname=a.classname,e.form.categoryId=a.category_id,e.form.synopsis=a.synopsis,e.form.content=a.content,e.form.original=a.original,e.form.userId=s,e.buttonText="修改文章",e.url="editArticle/"+t,e.type="put",console.log(e.form.userId,"this.form.userId");case 17:case"end":return r.stop()}},r,e)}))()},getCategoryData:function(){var t=this;return l()(i.a.mark(function e(){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.post("category");case 2:r=e.sent,t.categoryData=r.list;case 4:case"end":return e.stop()}},e,t)}))()},imgAdd:function(t,e){var r=this;return l()(i.a.mark(function a(){var s,n,o;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(s=new FormData).append("file",e),a.prev=2,a.next=5,r.$http({url:"uploadFile?uploadDir=./uploadFile/article&type=image",method:"post",data:s,headers:{"Content-Type":"multipart/form-data"}});case 5:n=a.sent,200===(o=n.data).status&&r.$refs.mavonEditor.$img2Url(t,r.Global.baseURL+o.url),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(2),console.log(a.t0),r.$message.error("请求超时~");case 14:case"end":return a.stop()}},a,r,[[2,10]])}))()},imgDel:function(t){var e=this;return l()(i.a.mark(function r(){var a,s,n;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=t[0].indexOf("uploadFile"),s="./"+t[0].slice(a),n={path:s};try{e.$http.post("deleteFile",n)}catch(t){console.log(t)}case 4:case"end":return r.stop()}},r,e)}))()},handleCancel:function(){window.sessionStorage.removeItem("articleData"),this.$router.push({name:"articleList"})},getUserList:function(){var t=this;return l()(i.a.mark(function e(){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("user/list");case 2:r=e.sent,t.userList=[{id:0,username:"所有人"}].concat(r);case 4:case"end":return e.stop()}},e,t)}))()}},watch:{"$route.path":function(t,e){"/admin/addArticle"===t?(this.form.title="",this.form.classname="",this.form.synopsis="",this.form.content="",this.buttonText="修改文章",this.url="addArticle",this.type="post"):this.buttonText="添加文章"}}},u={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content_right"},[r("h4",[t._v(t._s(t.buttonText))]),t._v(" "),r("el-form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-width":"80px","hide-required-asterisk":!0}},[r("el-form-item",{staticClass:"box",attrs:{label:"文章标题",prop:"title"}},[r("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"文章分类",prop:"classname"}},[r("el-select",{attrs:{placeholder:"请选择分类"},model:{value:t.form.classname,callback:function(e){t.$set(t.form,"classname",e)},expression:"form.classname"}},t._l(t.categoryData,function(t){return r("el-option",{key:t.id,attrs:{label:t.classname,value:t.id}})}),1)],1),t._v(" "),r("el-form-item",{attrs:{label:"添加权限",prop:"userId"}},[r("el-select",{attrs:{multiple:"",placeholder:"请选择查看文章的用户"},model:{value:t.form.userId,callback:function(e){t.$set(t.form,"userId",e)},expression:"form.userId"}},t._l(t.userList,function(t){return r("el-option",{key:t.id,attrs:{label:t.username,value:t.id}})}),1)],1),t._v(" "),r("el-form-item",{attrs:{label:"文章简介",prop:"synopsis"}},[r("el-input",{attrs:{type:"textarea"},model:{value:t.form.synopsis,callback:function(e){t.$set(t.form,"synopsis",e)},expression:"form.synopsis"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"文章出自"}},[r("el-radio",{attrs:{label:0},model:{value:t.form.original,callback:function(e){t.$set(t.form,"original",e)},expression:"form.original"}},[t._v("原创")]),t._v(" "),r("el-radio",{attrs:{label:1},model:{value:t.form.original,callback:function(e){t.$set(t.form,"original",e)},expression:"form.original"}},[t._v("转载")])],1),t._v(" "),r("mavon-editor",{ref:"mavonEditor",attrs:{subfield:!0},on:{imgAdd:t.imgAdd,save:t.addArticle,imgDel:t.imgDel},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),t._v(" "),r("el-form-item",{staticStyle:{"margin-top":"22px"}},[r("el-button",{attrs:{type:"primary"},on:{click:t.addArticle}},[t._v(t._s(t.buttonText))]),t._v(" "),r("el-button",{on:{click:t.handleCancel}},[t._v("取消")])],1)],1)],1)},staticRenderFns:[]};var m=r("VU/8")(c,u,!1,function(t){r("nKSH")},"data-v-760d2561",null);e.default=m.exports},nKSH:function(t,e){}});